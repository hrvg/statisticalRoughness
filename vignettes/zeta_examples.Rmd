---
title: "Example of anisotropic landscapes"
author:
- name: HervÃ© Guillon
date: "`r format(Sys.time(), '%d %B %Y')`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Example of anisotropic landscapes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: bibliography.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 8, 
  fig.height = 8,
  warning = FALSE,
  message = FALSE
)
```

# Purpose

This vignette displays the calculation of anisotropy exponent for different landscapes.

```{r devtools}
devtools::load_all()
```

```{r, echo = FALSE}
library(rayshader)
view_rotated_raster <- function(rstr, raster_resolution = 9.015, nbin = 50, .Hann = TRUE, .quantile_prob = c(0.9999)){
	rstr <- rstr %>% detrend_dem() 
	FT2D <- fft2D(raster::as.matrix(rstr), dx = raster_resolution, dy = raster_resolution, Hann = .Hann)
	binned_power_spectrum <- bin(log10(FT2D$radial_frequency_vector), log10(FT2D$spectral_power_vector), nbin) %>% na.omit()
	normalized_spectral_power_matrix <- get_normalized_spectral_power_matrix(binned_power_spectrum, FT2D)
	filtered_spectral_power_matrix <- filter_spectral_power_matrix(normalized_spectral_power_matrix, FT2D, quantile_prob = .quantile_prob)
	ang_fourier <- get_fourier_angle(filtered_spectral_power_matrix, FT2D)
	rotated_raster <- rotate_raster(raster::as.matrix(rstr), ang_fourier)
	matrix_for_rayshader(rotated_raster) %>%
		sphere_shade(texture = "desert") %>%
	    add_shadow(ray_shade(matrix_for_rayshader(rotated_raster), sunaltitude = 20), max_darken = 0.3) %>%  
	    add_shadow(ambient_shade(matrix_for_rayshader(rotated_raster)), 0) %>%
	    plot_map()
}
```

# Gabilan Mesa

```{r}
gabilan_mesa <- raster::raster(file.path(system.file("extdata/rasters/", package = "statisticalRoughness"), "gabilan_mesa.tif"))
summary(gabilan_mesa)
results <- get_zeta(gabilan_mesa) 
```

```{r, echo = FALSE}
matrix_for_rayshader(raster::as.matrix(gabilan_mesa)) %>%
		sphere_shade(texture = "desert") %>%
	    add_shadow(ray_shade(matrix_for_rayshader(raster::as.matrix(gabilan_mesa)), sunaltitude = 20), max_darken = 0.3) %>%  
	    add_shadow(ambient_shade(matrix_for_rayshader(raster::as.matrix(gabilan_mesa))), 0) %>%
	    plot_map()
# view_rotated_raster(gabilan_mesa)
```

|             $\alpha_{1,x}$              |             $\alpha_{1,y}$              |           $\zeta_{1}$           |             $\alpha_{2,x}$              |             $\alpha_{2,y}$              |            $\zeta_2$            |                                        $r_c$                                        |                                   $r_{max}$                                   |               $\theta_x$               |              $\theta_y$               |
|:---------------------------------------:|:---------------------------------------:|:-------------------------------:|:---------------------------------------:|:---------------------------------------:|:-------------------------------:|:-----------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------:|:--------------------------------------:|:-------------------------------------:|
| `r results$slope1_mean.x %>% signif(3)` | `r results$slope1_mean.y %>% signif(3)` | `r results$zeta1 %>% signif(3)` | `r results$slope2_mean.x %>% signif(3)` | `r results$slope2_mean.y %>% signif(3)` | `r results$zeta2 %>% signif(3)` | `r mean(c(results$change_point_mean.x, results$change_point_mean.y)) %>% signif(3)` | `r mean(c(results$max_point_mean.x, results$max_point_mean.y)) %>% signif(3)` | `r results$theta %% 180 %>% signif(3)` | `r results$theta %% 90 %>% signif(3)` |


# Yosemite

```{r}
yosemite <- raster::raster(file.path(system.file("extdata/rasters/", package = "statisticalRoughness"), "yosemite.tif"))
results <- get_zeta(yosemite) 
```

```{r, echo = FALSE}
matrix_for_rayshader(raster::as.matrix(yosemite)) %>%
		sphere_shade(texture = "desert") %>%
	    add_shadow(ray_shade(matrix_for_rayshader(raster::as.matrix(yosemite)), sunaltitude = 20), max_darken = 0.3) %>%  
	    plot_map()
# view_rotated_raster(yosemite)
```

|             $\alpha_{1,x}$              |             $\alpha_{1,y}$              |           $\zeta_{1}$           |             $\alpha_{2,x}$              |             $\alpha_{2,y}$              |            $\zeta_2$            |                                        $r_c$                                        |                                   $r_{max}$                                   |               $\theta_x$               |              $\theta_y$               |
|:---------------------------------------:|:---------------------------------------:|:-------------------------------:|:---------------------------------------:|:---------------------------------------:|:-------------------------------:|:-----------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------:|:--------------------------------------:|:-------------------------------------:|
| `r results$slope1_mean.x %>% signif(3)` | `r results$slope1_mean.y %>% signif(3)` | `r results$zeta1 %>% signif(3)` | `r results$slope2_mean.x %>% signif(3)` | `r results$slope2_mean.y %>% signif(3)` | `r results$zeta2 %>% signif(3)` | `r mean(c(results$change_point_mean.x, results$change_point_mean.y)) %>% signif(3)` | `r mean(c(results$max_point_mean.x, results$max_point_mean.y)) %>% signif(3)` | `r results$theta %% 180 %>% signif(3)` | `r results$theta %% 90 %>% signif(3)` |



# Modoc

```{r}
modoc <- raster::raster(file.path(system.file("extdata/rasters/", package = "statisticalRoughness"), "modoc.tif"))
results <- get_zeta(modoc) 
```

```{r, echo = FALSE}
matrix_for_rayshader(raster::as.matrix(modoc)) %>%
		sphere_shade(texture = "desert") %>%
	    add_shadow(ray_shade(matrix_for_rayshader(raster::as.matrix(modoc)), sunaltitude = 20), max_darken = 0.3) %>%  
	    add_shadow(ambient_shade(matrix_for_rayshader(raster::as.matrix(modoc))), 0) %>%
	    plot_map()
# view_rotated_raster(modoc)
```

|             $\alpha_{1,x}$              |             $\alpha_{1,y}$              |           $\zeta_{1}$           |             $\alpha_{2,x}$              |             $\alpha_{2,y}$              |            $\zeta_2$            |                                        $r_c$                                        |                                   $r_{max}$                                   |               $\theta_x$               |              $\theta_y$               |
|:---------------------------------------:|:---------------------------------------:|:-------------------------------:|:---------------------------------------:|:---------------------------------------:|:-------------------------------:|:-----------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------:|:--------------------------------------:|:-------------------------------------:|
| `r results$slope1_mean.x %>% signif(3)` | `r results$slope1_mean.y %>% signif(3)` | `r results$zeta1 %>% signif(3)` | `r results$slope2_mean.x %>% signif(3)` | `r results$slope2_mean.y %>% signif(3)` | `r results$zeta2 %>% signif(3)` | `r mean(c(results$change_point_mean.x, results$change_point_mean.y)) %>% signif(3)` | `r mean(c(results$max_point_mean.x, results$max_point_mean.y)) %>% signif(3)` | `r results$theta %% 180 %>% signif(3)` | `r results$theta %% 90 %>% signif(3)` |

